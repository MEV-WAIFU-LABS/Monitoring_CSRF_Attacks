<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Runtime - RDoc Documentation</title>

<link type="text/css" media="screen" href="./rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
</script>

<script type="text/javascript" charset="utf-8" src="./js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="./js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="./index.html">Home</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/runtime.rb
    <li>other_languages/C++/monCSRF_C++/lib/runtime.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-run">::run</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    <nav id="fileindex-section" class="section project-section">
  <h3 class="section-header">Pages</h3>

  <ul>
  
    <li class="file"><a href="./Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="./README_rdoc.html">README</a>
  
    <li class="file"><a href="./lib/log_parser/strategies/sql/README_strategies.html">README_strategies</a>
  
    <li class="file"><a href="./lib/log_parser/strategies/sql/dot_to_png.html">dot_to_png</a>
  
    <li class="file"><a href="./logs/attack_log.html">attack_log</a>
  
    <li class="file"><a href="./logs/log.html">log</a>
  
    <li class="file"><a href="./logs/log_simple.html">log_simple</a>
  
    <li class="file"><a href="./logs/log_tests.html">log_tests</a>
  
    <li class="file"><a href="./logs/white_list.html">white_list</a>
  
    <li class="file"><a href="./logs/white_list2.html">white_list2</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/Gemfile.html">Gemfile</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/Makefile.html">Makefile</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/README.html">README</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/README_rdoc.html">README</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/attack_log.html">attack_log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/demos/README.html">README</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/demos/README~.html">README~</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/lib/log_parser/strategies/sql/README_strategies.html">README_strategies</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs/README.html">README</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs/README~.html">README~</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs/log.html">log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/attack_log.html">attack_log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/log.html">log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/log_simple.html">log_simple</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/log_tests.html">log_tests</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/white_list.html">white_list</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/logs~b265d9806d0c7629e7eff6ef2fc8d8c8df5f52a6/white_list2.html">white_list2</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/attack_log.html">attack_log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/log.html">log</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/log_simple.html">log_simple</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/log_tests.html">log_tests</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/white_list.html">white_list</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/spec/fixtures/white_list2.html">white_list2</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/white_list.html">white_list</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/white_list~.html">white_list~</a>
  
    <li class="file"><a href="./other_languages/C++/monCSRF_C++/whitelist_txt.html">whitelist</a>
  
    <li class="file"><a href="./other_languages/py/moncsrfpy/log.html">log</a>
  
    <li class="file"><a href="./other_languages/py/moncsrfpy/tests/GIT.html">GIT</a>
  
    <li class="file"><a href="./other_languages/py/moncsrfpy/tests/README.html">README</a>
  
    <li class="file"><a href="./other_languages/py/moncsrfpy/tests/README~.html">README~</a>
  
    <li class="file"><a href="./spec/fixtures/attack_log.html">attack_log</a>
  
    <li class="file"><a href="./spec/fixtures/log.html">log</a>
  
    <li class="file"><a href="./spec/fixtures/log_simple.html">log_simple</a>
  
    <li class="file"><a href="./spec/fixtures/log_tests.html">log_tests</a>
  
    <li class="file"><a href="./spec/fixtures/white_list.html">white_list</a>
  
    <li class="file"><a href="./spec/fixtures/white_list2.html">white_list2</a>
  
    <li class="file"><a href="./white_list.html">white_list</a>
  
    <li class="file"><a href="./white_list~.html">white_list~</a>
  
  </ul>
</nav>

    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="./LogParser.html">LogParser</a>
  
    <li><a href="./LogParser/Log.html">LogParser::Log</a>
  
    <li><a href="./LogParser/LogEntry.html">LogParser::LogEntry</a>
  
    <li><a href="./LogParser/SqlInfo.html">LogParser::SqlInfo</a>
  
    <li><a href="./LogParser/Strategies.html">LogParser::Strategies</a>
  
    <li><a href="./LogParser/Strategies/Sql.html">LogParser::Strategies::Sql</a>
  
    <li><a href="./LogParser/Strategies/Sql/Base.html">LogParser::Strategies::Sql::Base</a>
  
    <li><a href="./LogParser/Strategies/Sql/Ragel.html">LogParser::Strategies::Sql::Ragel</a>
  
    <li><a href="./LogParser/Strategies/Sql/Regexp.html">LogParser::Strategies::Sql::Regexp</a>
  
    <li><a href="./LogParser/WhiteList.html">LogParser::WhiteList</a>
  
    <li><a href="./Object.html">Object</a>
  
    <li><a href="./Runtime.html">Runtime</a>
  
    <li><a href="./Sql.html">Sql</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Runtime</h1>

  <div id="description" class="description">
    
<p>When we run /bin/parser.rb this is the main class that will be called to
run the parser. For each line from the log file, it searches entries that
are modifying the state of the system. It loops over the entries searching
SQL requests that matches these conditions. If it finds a match, it prints
an warning message.</p>

<p>When we run /bin/parser.rb this is the main class that will be called to
run the parser. For each line from the log file, it searches entries that
are modifying the state of the system. It loops over the entries searching
SQL requests that matches these conditions. If it finds a match, it prints
an warning message.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-run" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">run</span><span
            class="method-args">(log_file_name, benchmark = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Initiates the parser.</p>
          

          
          <div class="method-source-code" id="run-source">
            <pre><span class="ruby-comment"># File lib/runtime.rb, line 9</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">log_file_name</span>, <span class="ruby-identifier">benchmark</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">verbose</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">verbose</span> = <span class="ruby-keyword">true</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">benchmark</span>

  <span class="ruby-comment"># Opens the log file.</span>
  <span class="ruby-identifier">log</span> = <span class="ruby-constant">LogParser</span><span class="ruby-operator">::</span><span class="ruby-constant">Log</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">log_file_name</span>), <span class="ruby-identifier">verbose</span>)

  <span class="ruby-comment"># Opens the whitelist file.</span>
  <span class="ruby-identifier">white_list</span> = <span class="ruby-constant">LogParser</span><span class="ruby-operator">::</span><span class="ruby-constant">WhiteList</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">'white_list'</span>)

  <span class="ruby-comment"># Loops in all the entries of the log.</span>
  <span class="ruby-identifier">log</span>.<span class="ruby-identifier">total_entries</span>.<span class="ruby-identifier">times</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>

    <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">log</span>.<span class="ruby-identifier">get_entry</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-identifier">exit</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">benchmark</span>

    <span class="ruby-comment"># If the command is SQL:</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">command_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:mysql_query</span>
      <span class="ruby-identifier">sql_info</span> = <span class="ruby-constant">LogParser</span><span class="ruby-operator">::</span><span class="ruby-constant">SqlInfo</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">entry</span>.<span class="ruby-identifier">parameter</span> <span class="ruby-value">0</span>)

      <span class="ruby-comment"># If the SQL changed the state of the system,</span>
      <span class="ruby-comment"># (It might be an attack).</span>
      <span class="ruby-keyword">if</span> [<span class="ruby-value">:update</span>, <span class="ruby-value">:insert</span>, <span class="ruby-value">:delete</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">sql_info</span>.<span class="ruby-identifier">sql_type</span>)

        <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;              ------------------------------------------------&quot;</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;[WARNING]: A query \&quot;#{sql_info.normalized_sql}\&quot; was requested.&quot;</span>.<span class="ruby-identifier">red</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;           The origin request was: #{entry.parent_command.original_line}&quot;</span>

        <span class="ruby-comment"># If this request was not in the whitelist, the program flags it.</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">white_list</span>.<span class="ruby-identifier">listed?</span>(<span class="ruby-identifier">sql_info</span>)
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;[ACTION REQUIRED]: GET request changing the system state!&quot;</span>.<span class="ruby-identifier">red</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">command_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:GET</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;[ACTION REQUIRED]: POST request changing the system state!&quot;</span>.<span class="ruby-identifier">red</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">command_type</span> <span class="ruby-operator">==</span> <span class="ruby-value">:POST</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;Do you want to flag this request as safe? (y/n)&quot;</span>.<span class="ruby-identifier">blue</span>
          <span class="ruby-constant">STDOUT</span>.<span class="ruby-identifier">flush</span>
          <span class="ruby-identifier">white_list_it</span> = <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">chomp</span>

          <span class="ruby-comment"># If we mark the previous request to be whitelisted.</span>
          <span class="ruby-keyword">if</span> [<span class="ruby-string">'yes'</span>, <span class="ruby-string">'y'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">white_list_it</span>.<span class="ruby-identifier">downcase</span>)
            <span class="ruby-identifier">white_list</span>.<span class="ruby-identifier">add!</span>(<span class="ruby-identifier">sql_info</span>)
            <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;           [y] The request was whitelisted.&quot;</span>.<span class="ruby-identifier">green</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;           [n] The request was NOT whitelisted.&quot;</span>.<span class="ruby-identifier">red</span>
          <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;&quot;</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;[ATTENTION]: Similar request was already in the whitelist.&quot;</span>.<span class="ruby-identifier">green</span>
          <span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;              ------------------------------------------------&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">end</span>

<span class="ruby-keyword">end</span></pre>
          </div><!-- run-source -->
          
        </div>

        

        
      </div><!-- run-method -->

    
    </section><!-- public-class-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

